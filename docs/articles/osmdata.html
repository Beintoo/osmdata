<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
<ol style="list-style-type: decimal">
<li>osmdata</li>
</ol> • osmdata</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">osmdata</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Overview</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/osmdatar/osmdata">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1><ol style="list-style-type: decimal">
<li>osmdata</li>
</ol></h1>
                        <h4 class="author">Mark Padgham</h4>
            
            <h4 class="date">2017-02-27</h4>
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#introduction" class="anchor"> </a></body></html>1. Introduction</h2>
<p><code>osmdata</code> is an R package for downloading and using data from OpenStreetMap (OSM). OSM is a global open access mapping project, which anyone can contribute to or access data from <span class="citation">(OpenStreetMap contributors 2017)</span>. People new to OSM are recommended to explore what the maps look like at <a href="www.openstreetmap.org/" class="uri">www.openstreetmap.org/</a>, where you can also sign-up to edit the map for your local area.</p>
<p>The aim <code>osmdata</code> is to facilitate access and use of OSM with R. It is fair to say that using OSM data in R, and many other languages, has never been easy. <span class="citation">Eugster and Schlesinger (2012)</span> describes a <code>osmar</code>, an R package for handling OSM data that enables visualisation, search and even rudimentary routing operations. <code>osmar</code> is not user friendly or able to download OSM data flexibly, as reported in an <a href="http://eprints.whiterose.ac.uk/77643/">early tutorial</a> comparing R and QGIS for handling OSM data <span class="citation">(Lovelace 2014)</span>.</p>
<p><code>osmdata</code> builds on two previous R packages: <code>osmplotr</code>, a package <a href="https://cran.r-project.org/package=osmplotr">available from CRAN</a> for accessing and plotting OSM data <span class="citation">(Padgham 2016)</span> and <code>overpass</code>, a <a href="https://github.com/hrbrmstr/overpass">GitHub package</a> by Bob Rudis that provides an R interface to the <a href="http://overpass-api.de/">overpass</a> API.</p>
<p>The development version of the <code>osmdata</code> R package can be installed with the <code>devtools</code> (which can be installed with <code>install.packages("devtools")</code>) as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools::<span class="kw">install_github</span>(<span class="st">"osmdatar/osmdata"</span>)</code></pre></div>
<p>Once installed, it can be loaded in the usual way:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(osmdata)</code></pre></div>
<p><code>osmdata</code> uses the <a href="http://overpass-api.de"><code>overpass</code> API</a> to download OpenStreetMap (OSM) data and convert the results to either <a href="https://cran.r-project.org/package=sf">Simple Features (SF)</a> or <a href="http://cran.r-project.org/package=sp"><code>Spatial</code></a> objects, defined by the <code>sf</code> and <code>sp</code> packages respectively. <code>overpass</code> is a C++ library that serves OSM data over the web (see code at <a href="https://github.com/drolbr/Overpass-API">github.com/drolbr/Overpass-API</a>). It has its own query language, with all queries extracting data within a defined bounding box. A query may be initiated using the <code>osmdata</code> function <code><a href="../reference/opq.html">opq()</a></code>, which accepts the single argument of a bounding box.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/opq.html">opq</a></span> (<span class="dt">bbox=</span><span class="kw">c</span>(<span class="fl">51.1</span>,<span class="fl">0.1</span>,<span class="fl">51.2</span>,<span class="fl">0.2</span>))</code></pre></div>
<p>Bounding boxes may also be defined by simply passing the name of a desired area, which does not have be precise:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/opq.html">opq</a></span> (<span class="dt">bbox=</span><span class="st">"Greater London, U.K."</span>)
<span class="kw">identical</span> (<span class="kw"><a href="../reference/opq.html">opq</a></span> (<span class="dt">bbox=</span><span class="st">"Greater London, U.K."</span>), <span class="kw"><a href="../reference/opq.html">opq</a></span> (<span class="dt">bbox=</span><span class="st">"greater london uk"</span>))</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>An <code>osmdata</code> query consists of an initial <code><a href="../reference/opq.html">opq()</a></code> query and one or more ‘features’, which are classified key-value pairs (see <a href="http://wiki.openstreetmap.org/wiki">wiki.openstreetmap.org/wiki/</a> for detailed <a href="https://wiki.openstreetmap.org/wiki/Category:Keys">description of features</a> and <a href="https://wiki.openstreetmap.org/wiki/Category:Keys">a list of all OSM keys</a>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/opq.html">opq</a></span> (<span class="dt">bbox=</span><span class="st">"greater london uk"</span>)
q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span> (q, <span class="dt">key=</span><span class="st">"highway"</span>, <span class="dt">value=</span><span class="st">"motorway"</span>)</code></pre></div>
<p>The result is a list of class <code>overpass_query</code> that can be converted into URLs as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/qry_to_string.html">qry_to_string</a></span>(q)</code></pre></div>
<pre><code>## [1] "[out:xml][timeout:25];\n(\n node  [\"highway\"=\"motorway\"] (51.2867602,-0.510375,51.6918741,0.3340155);\n way  [\"highway\"=\"motorway\"] (51.2867602,-0.510375,51.6918741,0.3340155);\n relation  [\"highway\"=\"motorway\"] (51.2867602,-0.510375,51.6918741,0.3340155);\n\n);\n(._;&gt;);\nout body;"</code></pre>
<p>Internally, <code>osmdata</code> uses this to query the URLs from the base URL as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">base_url &lt;-<span class="st"> "http://overpass-api.de/api/interpreter"</span>
res &lt;-<span class="st"> </span>httr::<span class="kw">POST</span>(<span class="dt">url =</span> base_url, <span class="dt">query =</span> q)</code></pre></div>
<p><code>osmdata</code> saves you the effort of making these custom URLs and requests, and makes it easy download the data once the query has been constructed. The corresponding data may then be downloaded as follows:</p>
<p><code>overpass</code> data are returned in OSM XML format, and may be directly returned with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">doc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_xml.html">osmdata_xml</a></span> (q)</code></pre></div>
<p>The function <code><a href="../reference/osmdata_xml.html">osmdata_xml()</a></code> also allows data to be saved and used for subsequent queries through specifying a filename.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/osmdata_xml.html">osmdata_xml</a></span> (q, <span class="st">"motorways.osm"</span>)</code></pre></div>
<p>This downloads the raw data underlying OSM, in xml format by default. Let’s take a glimpse of this dataset:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">doc =<span class="st"> </span><span class="kw">readLines</span>(<span class="st">"motorways.osm"</span>)
doc[<span class="dv">1</span>:<span class="dv">5</span>] <span class="co"># the first 5 lines of the raw xml file</span></code></pre></div>
<pre><code>## [1] "&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;"                                                                             
## [2] "&lt;osm version=\"0.6\" generator=\"Overpass API\"&gt;"                                                                       
## [3] "  &lt;note&gt;The data included in this document is from www.openstreetmap.org. The data is made available under ODbL.&lt;/note&gt;"
## [4] "  &lt;meta osm_base=\"2017-02-27T10:23:02Z\"/&gt;"                                                                            
## [5] "  &lt;node id=\"104432\" lat=\"51.5739008\" lon=\"-0.2321402\"/&gt;"</code></pre>
<p>If you want to use this dataset in another program, like the excellent open source GIS <a href="http://qgis.org/en/site/">QGIS</a> or OSM data editor <a href="http://wiki.openstreetmap.org/wiki/JOSM">JOSM</a>, you can do so.</p>
<p>In QGIS this can then be loaded via a two-step process: <code>Vector &gt; OpenStreetMap &gt; Import topology from XML...</code> and open the <code>doc.osm</code> file saved previously, followed by <code>Vector &gt; OpenStreetMap &gt; Export topology to SpatialLite...</code>. The results are illustrated in the figure below:</p>
<div class="figure">
<img src="https://cloud.githubusercontent.com/assets/1825120/23326333/7189dd04-faf4-11e6-91f1-bd1b0c366cad.png">
</div>
<p><code>osmdata</code> is therefore useful even if you only want to download OSM data. The remainder of this vignette assumes that not only do you want to get OSM data using R, you also want to import and eventually process it, using R. For that you’ll need to import the data into a native R class.</p>
<p>These downloaded data can be directly processed by passing the same filename to <code>osmdata_sf/sp</code>. The following function imports the data into R as a <code>Spatial</code> object defined by the <code>sp</code> package, with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat_sp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_sp.html">osmdata_sp</a></span> (q, <span class="st">"motorways.osm"</span>)
dat_sp</code></pre></div>
<pre><code>## Object of class 'osmdata' with:
##                  $bbox : 51.2867602,-0.510375,51.6918741,0.3340155
##         $overpass_call : The call submitted to the overpass API
##             $timestamp : ##------ Mon Feb 27 10:23:02 2017 ------##
##            $osm_points : 'sp' SpatialpointsDataFrame with 4564 points
##             $osm_lines : 'sp' SpatiallinesDataFrame with 688 lines
##          $osm_polygons : 'sp' SpatialpolygonsDataFrame with 0 polygons
##        $osm_multilines : 'sp' SpatialmultilinesDataFrame with 0 multilines
##     $osm_multipolygons : 'sp' SpatialmultipolygonsDataFrame with 0 multipolygons</code></pre>
<p>Here’s how to load the data into Simple Features:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat_sf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q, <span class="st">"motorways.osm"</span>)
dat_sf</code></pre></div>
<p>The query, <code>q</code>, does not have to be submitted:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat_sf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (<span class="dt">doc=</span><span class="st">"motorways.osm"</span>)</code></pre></div>
<pre><code>## q missing: osmdata object will not include query</code></pre>
<p>Note also that you can also pass queries directly to the <code>osmdata_*</code> functions, as illustrated below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat_sp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_sp.html">osmdata_sp</a></span>(q)
dat_sf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q)</code></pre></div>
</div>
<div id="the-overpass-api" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#the-overpass-api" class="anchor"> </a></body></html>2. The overpass API</h2>
<p>The <code>overpass</code> API <a href="http://wiki.openstreetmap.org/wiki/Overpass_API">is</a> &gt; a read-only API that serves up custom selected parts of the OSM map data.</p>
<p>The syntax of queries is not easy to learn, making wrappers to it useful. An excellent place to explore <code>overpass</code> queries specifically and OSM data in general is the <a href="http://overpass-turbo.eu/">overpass-turbo website</a>. Examples of its functionality in action can be found on the <a href="http://wiki.openstreetmap.org/wiki/Overpass_API/Overpass_API_by_Example">OpenStreetMap wiki</a>.</p>
<div id="overpass-queries" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#overpass-queries" class="anchor"> </a></body></html>2.1. overpass queries</h3>
<p><code>overpass</code> has its own query language which largely works by extracting data based on specific combinations of <code>key-value</code> pairs, with <code>osmdata</code> implementing a simplified version. Full details of the <code>overpass</code> query language are given in the <a href="http://wiki.openstreetmap.org/wiki/Overpass_API/Overpass_QL">Query Language Guide</a> (and see also the <a href="http://wiki.openstreetmap.org/wiki/Overpass_API/Language_Guide">overpass API Language Guide</a> ).</p>
<p>As demonstrated above, an <code>osmdata</code> query begins by specifying a bounding box with the function <code><a href="../reference/opq.html">opq()</a></code>, followed by specifying desired OSM features with <code><a href="../reference/add_feature.html">add_feature()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/opq.html">opq</a></span> (<span class="dt">bbox=</span><span class="st">"Kunming, China"</span>)
q1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span> (q, <span class="dt">key=</span><span class="st">"natural"</span>, <span class="dt">value=</span><span class="st">"water"</span>)
q2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span> (q1, <span class="dt">key=</span><span class="st">"name:en"</span>, <span class="dt">value=</span><span class="st">"Dian"</span>, <span class="dt">exact=</span><span class="ot">FALSE</span>)</code></pre></div>
<p>The parameter <code>exact=FALSE</code> controls the two ways of matching <code>key-value</code> pairs in <code>overpass</code>: Either exactly and entirely, or through a partial string match. With the default <code>exact=TRUE</code>, this query would only return objects named “Dian”, and not, for example, any named “Lake Dian”. Using <code>exact=FALSE</code> will return “Lake Dian” through just specifying <code>value="Dian"</code>.</p>
<p>Each successive feature added with <code><a href="../reference/add_feature.html">add_feature()</a></code> is added to previous features, so, for example, extending the previous query by an additional <code>key-value</code> pair to</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span> (q2, <span class="dt">key=</span><span class="st">"highway"</span>)</code></pre></div>
<p>will request all objects that are both water bodies with names matching “Dian” <strong>AND</strong> that are also highways. Unsurprisingly, this query returns no data, but the previous queries do: <em>the filtering is more restrictive with each feature added with <code><a href="../reference/add_feature.html">add_feature()</a></code></em>. This is illustrated below by counting the number of points resulting from the queries generated previously:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># nrow (osmdata_sf (q)$osm_points) # all points in region - not shown</span>
<span class="kw">nrow</span> (<span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q1)$osm_points)</code></pre></div>
<pre><code>## [1] 7377</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">nrow</span> (<span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q2)$osm_points)</code></pre></div>
<pre><code>## [1] 2209</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">nrow</span> (<span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q3)$osm_points)</code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>In summary, distinct features must be requested with different queries, so it makes sense to give each query a separate name, e.g.:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat_water &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q1)
q_highway &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span> (q, <span class="dt">key=</span><span class="st">"highway"</span>)
dat_highway &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q2)</code></pre></div>
<p>The function <code>osmdata_sf</code> returns an object of class <code>osmdata</code>, as described in detail below.</p>
<p>The detailed structure of <code>overpass</code> queries can best be appreciated by using the <a href="http://overpass-turbo.eu">interactive online query builder</a>, which includes a helpful corrector function for incorrectly formatted queries. An <code>osmdata</code> query includes the two primary fields of <code>bbox</code> and <code>qry</code>, with the latter passed directly to the <code>overpass</code> API. Any queries constructed with the <a href="http://overpass-turbo.eu">interactive online query builder</a> can also be pasted directly into the <code>qry</code> component of an <code>osmdata</code> query.</p>
</div>
</div>
<div id="osmdata-queries" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#osmdata-queries" class="anchor"> </a></body></html>3. <code>osmdata</code> queries</h2>
<p>As indicated above, <code>osmdata</code> queries are generally simplified versions of potentially more complex <code>overpass</code> queries, although arbitrarily complex <code>overpass</code> queries may be pasted directly into the <code>$qry</code> field of an <code>osmdata</code> query. Also as illustrated above, <code>osmdata</code> queries are generally constructed through initiating a query with <code><a href="../reference/opq.html">opq()</a></code>, and then specifying OSM features in terms of <code>key-value</code> pairs with <code>add_feeature()</code>.</p>
<p>At its simplest, <code><a href="../reference/add_feature.html">add_feature()</a></code> requires a single <code>key</code>, which by default will return all objects specifying any value for that <code>key</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/opq.html">opq</a></span>(<span class="dt">bbox=</span><span class="st">"London City, U.K."</span>)
q1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span> (q0, <span class="dt">key=</span><span class="st">"highway"</span>)
q1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span> (q1, <span class="dt">key=</span><span class="st">"name"</span>)</code></pre></div>
<p>Passing that query to <code>osmdata_xml/sf/sp()</code> will return all named highways within the bounding box.</p>
<div id="building-a-query" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#building-a-query" class="anchor"> </a></body></html>3.1. Building a query</h3>
<p>Building on what we’ve already seen of the query-building methods presented above, let’s imagine that we wanted to find all cycle paths in Seville, Spain:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/opq.html">opq</a></span>(<span class="st">"Seville"</span>)
q1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span>(q0, <span class="dt">key =</span> <span class="st">"highway"</span>, <span class="dt">value =</span> <span class="st">"cycleway"</span>)
cway_sev =<span class="st"> </span><span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span>(q1)
sf:::<span class="kw">plot.sf</span>(cway_sev$osm_lines)</code></pre></div>
<pre><code>## Warning: plotting the first 9 out of 29 attributes; use max.plot = 29 to
## plot all</code></pre>
<p><img src="osmdata_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>The results show that there are many highways that OSM users have tagged as ‘cycleways’ in the city. Imagine we want to make a more specific query that only extracts cycleways in which <code>bicycle = designated</code> or which are bridges:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q2 =<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span>(q1, <span class="dt">key =</span> <span class="st">"bicycle"</span>, <span class="dt">value =</span> <span class="st">"designated"</span>)
cway_sev_bicycle =<span class="st"> </span><span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span>(q2)
q3 =<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span>(q1, <span class="dt">key =</span> <span class="st">"bridge"</span>, <span class="dt">value =</span> <span class="st">"yes"</span>)
cway_sev_bridge =<span class="st"> </span><span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span>(q3)</code></pre></div>
<p>Now, the results can be combined to create a collection of all paths meeting the criteria:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cpaths_sev =<span class="st"> </span><span class="kw">rbind</span>(cway_sev_bicycle$osm_lines[<span class="dv">1</span>:<span class="dv">3</span>], cway_sev_bridge$osm_lines[<span class="dv">1</span>:<span class="dv">3</span>])
sf:::<span class="kw">plot.sf</span>(cpaths_sev)</code></pre></div>
<p><img src="osmdata_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
</div>
<div id="submitting-a-query" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#submitting-a-query" class="anchor"> </a></body></html>3.2. Submitting a query</h3>
<p>As demonstrated above, <code>osmdata</code> queries may be submitted to <code>overpass</code> using one of three functions specified by the kind of data they return. <code><a href="../reference/osmdata_xml.html">osmdata_xml()</a></code> returns raw <code>XML</code> data, and enables these to be saved directly to disk for processing with other software.</p>
<p>Start with a new query</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/opq.html">opq</a></span> (<span class="dt">bbox=</span><span class="kw">c</span>(-<span class="fl">0.12</span>,<span class="fl">51.51</span>,-<span class="fl">0.11</span>,<span class="fl">51.52</span>)) <span class="co"># Central London, U.K.</span>
q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span> (q, <span class="dt">key=</span><span class="st">'building'</span>)</code></pre></div>
<p>The OSM data can then be saved as an XML document with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/osmdata_xml.html">osmdata_xml</a></span> (q, <span class="st">"buildings.osm"</span>)</code></pre></div>
<p>The other two functions return data in the two primary <code>R</code> formats for storing and processing spatial data: <code>R Spatial (sp)</code> and <code>R Simple Features (sf)</code>. Both of these functions accept optional arguments specifying previously downloaded files (using <code><a href="../reference/osmdata_xml.html">osmdata_xml()</a></code>) or an <code>XML</code> document.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q, <span class="st">"buildings.osm"</span>)
doc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_xml.html">osmdata_xml</a></span> (q, <span class="dt">file=</span><span class="st">"bldgs2.osm"</span>)
<span class="kw">identical</span> (<span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q, doc), <span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q, <span class="st">"bldgs2.osm"</span>))</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
</div>
<div id="the-osmdata-object" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#the-osmdata-object" class="anchor"> </a></body></html>4. The <code>osmdata</code> object</h2>
<p>The <code>osmdata</code> extraction functions, <code><a href="../reference/osmdata_sf.html">osmdata_sf()</a></code>, and <code><a href="../reference/osmdata_sp.html">osmdata_sp()</a></code>, both return objects of class <code>osmdata</code>, the structure of which is shown with the generic print method as demonstrated above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span> (<span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q, <span class="st">"buildings.osm"</span>))</code></pre></div>
<pre><code>## [1] "list"    "osmdata"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span> (<span class="kw"><a href="../reference/osmdata_sp.html">osmdata_sp</a></span> (q, <span class="st">"buildings.osm"</span>))</code></pre></div>
<pre><code>## [1] "list"    "osmdata"</code></pre>
<p>The actual spatial data contained in an <code>osmdata</code> object are of either <code>sp</code> format when extracted with <code><a href="../reference/osmdata_sp.html">osmdata_sp()</a></code> or <code>sf</code> format when extracted with <code><a href="../reference/osmdata_sf.html">osmdata_sf()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span> (<span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q, <span class="st">"buildings.osm"</span>)$osm_lines)</code></pre></div>
<pre><code>## [1] "sf"         "data.frame"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span> (<span class="kw"><a href="../reference/osmdata_sp.html">osmdata_sp</a></span> (q, <span class="st">"buildings.osm"</span>)$osm_lines)</code></pre></div>
<pre><code>## [1] "SpatialLinesDataFrame"
## attr(,"package")
## [1] "sp"</code></pre>
<div id="the-osmdata_xml-function" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#the-osmdata_xml-function" class="anchor"> </a></body></html>4.1. The <code><a href="../reference/osmdata_xml.html">osmdata_xml()</a></code> function</h3>
<p><code><a href="../reference/osmdata_xml.html">osmdata_xml()</a></code> returns OSM data in native XML format, which are stored by convention with the file suffix <code>.osm</code>. This function also allows raw data to be saved to disk, as demonstrated above. The <code>XML</code> data are formatting using the <code>R</code> package <code>xml2</code>, and may be processed within <code>R</code> using any methods compatible with such data, or may be processed by any other software able to load the <code>XML</code> data directly from disk.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span> (<span class="kw"><a href="../reference/osmdata_xml.html">osmdata_xml</a></span> (q))</code></pre></div>
<pre><code>## [1] "xml_document" "xml_node"</code></pre>
</div>
<div id="the-osmdata_sf-function" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#the-osmdata_sf-function" class="anchor"> </a></body></html>4.2. The <code><a href="../reference/osmdata_sf.html">osmdata_sf()</a></code> function</h3>
<p><code><a href="../reference/osmdata_sf.html">osmdata_sf()</a></code> returns OSM data in <a href="http://www.opengeospatial.org/standards/sfo">Simple Features (SF)</a> format, defined by the <a href="http://www.opengeospatial.org">Open Geospatial Consortium</a>, and implemented in the <code>R</code> package <a href="https://cran.r-proejct.org/package=sf"><code>sf</code></a>. This package provides a direct interface to the <code>C++</code> <a href="http://gdal.org">Graphical Data Abstraction Library (GDAL)</a> which also includes a so-called <a href="http://www.gdal.org/drv_osm.html"><code>driver</code> for OSM data</a>. This means that OSM data may also be read directly with <code>sf</code>, rather than using <code>osmdata</code>. Data must first be saved to disk, which can for example be readily achieved through downloading directly from the <a href="http://overpass-turbo.eu">overpass interactive query builder</a>.</p>
<p>Queries constructed in <code>osmdata</code> can also be pasted directly into <code>overpass turbo</code>. The following example is based on this query:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/opq.html">opq</a></span> (<span class="dt">bbox=</span><span class="st">"Trentham, Australia"</span>)
q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span> (q, <span class="dt">key=</span><span class="st">"name"</span>) <span class="co"># any named objects</span>
<span class="kw"><a href="../reference/osmdata_xml.html">osmdata_xml</a></span> (q, <span class="st">"trentham.osm"</span>)</code></pre></div>
<p><code>sf</code> can then read such data independent of <code>osmdata</code> though</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sf::<span class="kw">st_read</span> (<span class="st">"trentham.osm"</span>, <span class="dt">layer=</span><span class="st">"lines"</span>)</code></pre></div>
<pre><code>## Reading layer `lines' from data source `/home/robin/other-repos/osmdata/docs/articles/trentham.osm' using driver `OSM'
## Simple feature collection with 243 features and 9 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: 143.6481 ymin: -37.86426 xmax: 144.5562 ymax: -37.14766
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs</code></pre>
<p>The <code>GDAL</code> drivers used by <code>sf</code> can only load single ‘layers’ of features, for example, <code>points</code>, <code>lines</code>, or <code>polygons</code>. In contrast, <code>osmdata</code> loads all features simultaneously:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q, <span class="st">"trentham.osm"</span>)</code></pre></div>
<pre><code>## Object of class 'osmdata' with:
##                  $bbox : -37.4300874,144.2863388,-37.3500874,144.3663388
##         $overpass_call : The call submitted to the overpass API
##             $timestamp : ##------ Mon Feb 27 10:23:02 2017 ------##
##            $osm_points : 'sf' Simple Features Collection with 7166 points
##             $osm_lines : 'sf' Simple Features Collection with 263 linestrings
##          $osm_polygons : 'sf' Simple Features Collection with 37 polygons
##        $osm_multilines : 'sf' Simple Features Collection with 1 multilinestrings
##     $osm_multipolygons : 'sf' Simple Features Collection with 6 multipolygons</code></pre>
<p>Even for spatial objects of the same type (the same ‘layers’ in <code>sf</code> terminology), <code>osmdata</code> returns considerably more objects. The raw sizes of data returned can be compared with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.numeric</span> (<span class="kw">object.size</span> (<span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q, <span class="st">"trentham.osm"</span>)$osm_lines) /
<span class="st">    </span><span class="kw">object.size</span> (sf::<span class="kw">st_read</span> (<span class="st">"trentham.osm"</span>, <span class="dt">layer=</span><span class="st">"lines"</span>, <span class="dt">quiet=</span><span class="ot">TRUE</span>)))</code></pre></div>
<pre><code>## [1] 5.526765</code></pre>
<p>And the <code>osmdata lines</code> contain over five times as much data. The primary difference between <code>sf/GDAL</code> and <code>osmdata</code> is that the former returns only those objects unique to each category of spatial object. Thus OSM nodes (<code>points</code> in <code>sf/osmdata</code> representations) include, in <code>sf/GDAL</code> representation, only those points which are not part of any other objects (such as lines or polygons). In contrast, <code>osmdata point</code> objects include all points regardless of whether or not these are represented in other spatial objects. Similarly, ‘line’ objects in ‘sf/GDAL’ exclude any lines that are part of other objects such as ‘multipolygon’ or ‘multiline’ objects.</p>
<p>This processing of data by <code>sf/GDAL</code> has two important implications:</p>
<ol style="list-style-type: decimal">
<li><p>An implicit hierarchy of spatial objects is enforced through including elements of objects only at their ‘highest’ level of representation, where <code>multipolygon</code> and <code>multiline</code> objects are assumed to be at ‘higher’ levels than <code>polyon</code> or <code>line</code> objects, and these in turn are at ‘higher’ levels than <code>point</code> objects. <code>osmdata</code> makes no such hierarchical assumptions.</p></li>
<li><p>All OSM are structured by giving each object a unique identifier so that the components of any given object (the nodes of a line, for example, or the lines of a multipolygon) can be referenced in terms of these identifiers alone. This enables the full details for any component of a given object to be extracted by examining that component. The <code>sf/GDAL</code> representation obviates this ability through removing these IDs and reducing everything to geometries alone. This means, for example, that the <code>key-value</code> pairs of the <code>line</code> or <code>polygon</code> components of <code>multipolygon</code> can never be extracted from an <code>sf/GDAL</code> representation. In contrast, <code>osmdata</code> retains all unique identifiers for all OSM objects, and so readily enables, for example, the properties of all <code>point</code> objects of a <code>line</code> to be extracted.</p></li>
</ol>
<p>Finally, note that <code>osmdata</code> will generally extract OSM data considerably faster than equivalent <code>sf/GDAL</code> routines (as detailed <a href="git-wiki">here</a>).</p>
</div>
<div id="the-osmdata_sp-function" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#the-osmdata_sp-function" class="anchor"> </a></body></html>4.3. The <code><a href="../reference/osmdata_sp.html">osmdata_sp()</a></code> function</h3>
<p>As with <code><a href="../reference/osmdata_sf.html">osmdata_sf()</a></code> described above, OSM data may be converted to <code>sp</code> format without using <code>osmdata</code> via the <code>sf</code> functions</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span>sf::<span class="kw">st_read</span> (<span class="st">"buildings.osm"</span>, <span class="dt">layer=</span><span class="st">"multipolygons"</span>)</code></pre></div>
<pre><code>## Reading layer `multipolygons' from data source `/home/robin/other-repos/osmdata/docs/articles/buildings.osm' using driver `OSM'
## Simple feature collection with 560 features and 25 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -0.1211933 ymin: 51.50953 xmax: -0.1090566 ymax: 51.52082
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat_sp &lt;-<span class="st"> </span><span class="kw">as</span> (dat, <span class="st">"Spatial"</span>)
<span class="kw">class</span> (dat_sp)</code></pre></div>
<pre><code>## [1] "SpatialPolygonsDataFrame"
## attr(,"package")
## [1] "sp"</code></pre>
<p>These data are extracted using the GDAL, and so suffer all of the same shortcomings mentioned above. Note differences in the amount of data returned:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span> (dat_sp)</code></pre></div>
<pre><code>## [1] 560  25</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span> (<span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q, <span class="dt">doc=</span><span class="st">'buildings.osm'</span>)$osm_polygons); <span class="kw">dim</span> (<span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q, <span class="dt">doc=</span><span class="st">'buildings.osm'</span>)$osm_multipolygons)</code></pre></div>
<pre><code>## [1] 566 116</code></pre>
<pre><code>## [1] 15 54</code></pre>
</div>
</div>
<div id="recursive-searching" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#recursive-searching" class="anchor"> </a></body></html>5. Recursive searching</h2>
<p>OSM data are structured in three hierarchical levels:</p>
<ol style="list-style-type: decimal">
<li><p><code>nodes</code> representing spatial points</p></li>
<li><p><code>ways</code> representing lines, both as <code>polygons</code> (with connected ends) and non-polygonal <code>lines</code></p></li>
<li><p><code>relations</code> representing more complex objects generally comprising collections of <code>ways</code> and/or <code>nodes. Examples include</code>multipolygon relations<code>comprising an outer polygon (which may itself be made of several    distinct</code>ways` which ultimately connect to form a single circle), and several inner polygons.</p></li>
</ol>
<p><code>osmdata</code> contains several functions which can be used to extract the components of individual objects.</p>
<ol style="list-style-type: decimal">
<li><p><code>osm_points</code> extracts all <code>point</code> or <code>node</code> objects</p></li>
<li><p><code>osm_lines</code> extracts all <code>way</code> objects that are <code>lines</code> (that are, that are not <code>polygons</code>)</p></li>
<li><p><code>osm_polygons</code> extracts all <code>polygon</code> objects</p></li>
<li><p><code>osm_multilines</code> extracts all <code>multiline</code> objects; and</p></li>
<li><p><code>osm_multipolygons</code> extracts all <code>multipolygon</code> objects.</p></li>
</ol>
<p>This is illustrated with data already loaded (note the need to specify the ids of features that comprise the result):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">id &lt;-<span class="st"> </span><span class="kw">as.character</span>(cway_sev$osm_points$osm_id)
cway_lines &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osm_lines.html">osm_lines</a></span>(<span class="dt">dat =</span> cway_sev, <span class="dt">id =</span> id)</code></pre></div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<html><body><a href="#references" class="anchor"> </a></body></html>6. References</h2>
<div id="refs" class="references">
<div id="ref-eugster_osmar:_2012">
<p>Eugster, Manuel J a, and Thomas Schlesinger. 2012. “Osmar: OpenStreetMap and R.” <em>The R Journal</em> 5 (1): 53–64.</p>
</div>
<div id="ref-lovelace_harnessing_2014">
<p>Lovelace, Robin. 2014. “Harnessing Open Street Map Data with R and QGIS.” <em>EloGeo</em>.</p>
</div>
<div id="ref-OpenStreetMap">
<p>OpenStreetMap contributors. 2017. “Planet dump retrieved from http://planet.osm.org.” <a href="http://www.openstreetmap.org" class="uri">http://www.openstreetmap.org</a>.</p>
</div>
<div id="ref-osmplotr">
<p>Padgham, Mark. 2016. <em>Osmplotr: Customisable Images of Openstreetmap Data</em>. <a href="https://CRAN.R-project.org/package=osmplotr" class="uri">https://CRAN.R-project.org/package=osmplotr</a>.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">1. Introduction</a></li>
      <li><a href="#the-overpass-api">2. The overpass API</a></li>
      <li><a href="#osmdata-queries">3. <code>osmdata</code> queries</a></li>
      <li><a href="#the-osmdata-object">4. The <code>osmdata</code> object</a></li>
      <li><a href="#recursive-searching">5. Recursive searching</a></li>
      <li><a href="#references">6. References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Mark Padgham, Bob Rudis, Robin Lovelace, Maëlle Salmon.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
