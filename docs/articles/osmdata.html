<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
<ol style="list-style-type: decimal">
<li>osmdata</li>
</ol> • osmdata</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">osmdata</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Overview</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/osmdatar/osmdata">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1><ol style="list-style-type: decimal">
<li>osmdata</li>
</ol></h1>
                        <h4 class="author">Mark Padgham</h4>
            
            <h4 class="date">2017-03-07</h4>
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#introduction" class="anchor"> </a></body></html>1. Introduction</h2>
<p><code>osmdata</code> is an R package for downloading and using data from OpenStreetMap (OSM). OSM is a global open access mapping project, which anyone can contribute to or access data from <span class="citation">(OpenStreetMap contributors 2017)</span>–see the main website at <a href="www.openstreetmap.org/" class="uri">www.openstreetmap.org/</a>.</p>
<p>The development version of the <code>osmdata</code> R package can be installed with the <code>devtools</code> package using the following command:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">'osmdatar/osmdata'</span>)</code></pre></div>
<pre><code>## '/usr/lib/R/bin/R' CMD INSTALL '/root/osmdata' --library='/tmp/RtmpscXAVq/devtools_install_46b1509d233c' --no-R --no-data --no-help --no-demo --no-inst --no-docs --no-exec --no-multiarch --no-test-load --preclean
## g++ -std=c++11 -I/usr/share/R/include -DNDEBUG   -I"/usr/local/lib/R/site-library/Rcpp/include"   -fpic  -g -O2 -fstack-protector --param=ssp-buffer-size=4 -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2 -g -c RcppExports.cpp -o RcppExports.o
## g++ -std=c++11 -I/usr/share/R/include -DNDEBUG   -I"/usr/local/lib/R/site-library/Rcpp/include"   -fpic  -g -O2 -fstack-protector --param=ssp-buffer-size=4 -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2 -g -c cleanup.cpp -o cleanup.o
## g++ -std=c++11 -I/usr/share/R/include -DNDEBUG   -I"/usr/local/lib/R/site-library/Rcpp/include"   -fpic  -g -O2 -fstack-protector --param=ssp-buffer-size=4 -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2 -g -c common.cpp -o common.o
## g++ -std=c++11 -I/usr/share/R/include -DNDEBUG   -I"/usr/local/lib/R/site-library/Rcpp/include"   -fpic  -g -O2 -fstack-protector --param=ssp-buffer-size=4 -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2 -g -c convert-osm-rcpp.cpp -o convert-osm-rcpp.o
## g++ -std=c++11 -I/usr/share/R/include -DNDEBUG   -I"/usr/local/lib/R/site-library/Rcpp/include"   -fpic  -g -O2 -fstack-protector --param=ssp-buffer-size=4 -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2 -g -c get-bbox.cpp -o get-bbox.o
## g++ -std=c++11 -I/usr/share/R/include -DNDEBUG   -I"/usr/local/lib/R/site-library/Rcpp/include"   -fpic  -g -O2 -fstack-protector --param=ssp-buffer-size=4 -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2 -g -c osmdata-sf.cpp -o osmdata-sf.o
## g++ -std=c++11 -I/usr/share/R/include -DNDEBUG   -I"/usr/local/lib/R/site-library/Rcpp/include"   -fpic  -g -O2 -fstack-protector --param=ssp-buffer-size=4 -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2 -g -c osmdata-sp.cpp -o osmdata-sp.o
## g++ -std=c++11 -I/usr/share/R/include -DNDEBUG   -I"/usr/local/lib/R/site-library/Rcpp/include"   -fpic  -g -O2 -fstack-protector --param=ssp-buffer-size=4 -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2 -g -c trace-osm.cpp -o trace-osm.o
## g++ -std=c++11 -shared -L/usr/lib/R/lib -Wl,-Bsymbolic-functions -Wl,-z,relro -o osmdata.so RcppExports.o cleanup.o common.o convert-osm-rcpp.o get-bbox.o osmdata-sf.o osmdata-sp.o trace-osm.o -L/usr/lib/R/lib -lR</code></pre>
<p>Once installed, it can be loaded in the usual way:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(osmdata)</code></pre></div>
<p><code>osmdata</code> uses the <a href="http://overpass-api.de"><code>overpass</code> API</a> to download OpenStreetMap (OSM) data and can convert the results to either <a href="https://cran.r-project.org/package=sf">Simple Features (SF)</a> or <a href="https://cran.r-project.org/package=sp"><code>Spatial</code></a> objects, respectively defined by the <code>R</code> packages <code>sf</code> and <code>sp</code>. <code>overpass</code> is a C++ library that serves OSM data over the web. All <code>overpass</code> queries begin with a bounding box, defined in <code>osmdata</code> with the function <code><a href="../reference/opq.html">opq()</a></code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/opq.html">opq</a></span>(<span class="dt">bbox =</span> <span class="kw">c</span>(<span class="fl">51.1</span>, <span class="fl">0.1</span>, <span class="fl">51.2</span>, <span class="fl">0.2</span>))</code></pre></div>
<p>Bounding boxes may also be defined by simply passing the name of a desired area, which does not have be precise:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/opq.html">opq</a></span>(<span class="dt">bbox =</span> <span class="st">'Greater London, U.K.'</span>)
<span class="kw">identical</span>(<span class="kw"><a href="../reference/opq.html">opq</a></span>(<span class="dt">bbox =</span> <span class="st">'Greater London, U.K.'</span>), <span class="kw"><a href="../reference/opq.html">opq</a></span>(<span class="dt">bbox =</span> <span class="st">'greater london uk'</span>))</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Following the initial <code><a href="../reference/opq.html">opq()</a></code> call, <code>osmdata</code> queries are built by adding one or more ‘features’, which are specified in terms of <code>key-value</code> pairs. For example, all paths, ways, and roads are designated in OSM with <code>key=highway</code>, so that a query all motorways in greater London (UK) can be constructed as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/opq.html">opq</a></span>(<span class="dt">bbox =</span> <span class="st">'greater london uk'</span>)
q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span>(q, <span class="dt">key =</span> <span class="st">'highway'</span>, <span class="dt">value =</span> <span class="st">'motorway'</span>)</code></pre></div>
<p>A detailed description of features is provided at the <a href="https://wiki.openstreetmap.org/wiki/Category:Keys">OSM wiki</a>, or the <code>osmdata</code> function <code><a href="../reference/available_features.html">available_features()</a></code> can be used to retrive the comprehensive list of feature keys currently used in OSM.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span> (<span class="kw"><a href="../reference/available_features.html">available_features</a></span> ())</code></pre></div>
<pre><code>## [1] "4wd only"  "abandoned" "abutters"  "access"    "addr"      "addr:city"</code></pre>
<p>There are two primary <code>osmdata</code> functions for obtaining data from a query: <code><a href="../reference/osmdata_sf.html">osmdata_sf()</a></code> and <code><a href="../reference/osmdata_sp.html">osmdata_sp()</a></code>, which return data in <a href="https://cran.r-project.org/package=sf">Simple Features (<code>sf</code>)</a> and <a href="https://cran.r-project.org/package=sp">Spatial (<code>sp</code>)</a> formats, respectively.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q)</code></pre></div>
<pre><code>## Object of class 'osmdata' with:
##                  $bbox : 51.2867602,-0.510375,51.6918741,0.3340155
##         $overpass_call : The call submitted to the overpass API
##             $timestamp : [ Mon Mar  6 20:49:04 2017 ]
##            $osm_points : 'sf' Simple Features Collection with 4564 points
##             $osm_lines : 'sf' Simple Features Collection with 688 linestrings
##          $osm_polygons : 'sf' Simple Features Collection with 0 polygons
##        $osm_multilines : 'sf' Simple Features Collection with 0 multilinestrings
##     $osm_multipolygons : 'sf' Simple Features Collection with 0 multipolygons</code></pre>
<p><code><a href="../reference/osmdata_sp.html">osmdata_sp (q)</a></code> returns the equivalent data as <code>SpatialPointsDataFrame</code> and <code>SpatialLinesDataFrame</code> objects (with this particular query returning no <code>polygons</code> or <code>multi</code> objects).</p>
</div>
<div id="the-overpass-api" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#the-overpass-api" class="anchor"> </a></body></html>2. The overpass API</h2>
<p>As mentioned, <code>osmdata</code> obtains OSM data from the <a href="www.overpass-api.de"><code>overpass API</code></a>, <a href="http://wiki.openstreetmap.org/wiki/Overpass_API">which is</a></p>
<blockquote>
<p>a read-only API that serves up custom selected parts of the OSM map data.</p>
</blockquote>
<p>The syntax of <code>overpass</code> queries is powerful yet not easy to learn. This section briefly introduces the structure of <code>overpass</code> queries in order to help construct more efficient and powerful queries. Those wanting to skip straight onto query construction in <code>osmdata</code> may safely jump ahead to the <a href="#query-example">query example below</a>.</p>
<p><code>osmdata</code> simplifies queries so that OSM data can be extracted with very little understanding of the <code>overpass</code> query syntax, although it is still possible to submit arbitrarily complex <code>overpass</code> queries via <code>osmdata</code>. An excellent place to explore <code>overpass</code> queries specifically and OSM data in general is the online interactive query builder at <a href="http://overpass-turbo.eu/">overpass-turbo</a>, which includes a helpful corrector function for incorrectly formatted queries. Examples of its functionality in action can be found on the <a href="http://wiki.openstreetmap.org/wiki/Overpass_API/Overpass_API_by_Example">OpenStreetMap wiki</a>, with full details of the <code>overpass</code> query language given in the <a href="http://wiki.openstreetmap.org/wiki/Overpass_API/Overpass_QL">Query Language Guide</a> as well as the <a href="http://wiki.openstreetmap.org/wiki/Overpass_API/Language_Guide">overpass API Language Guide</a>.</p>
<p><code>osmdata</code> queries are lists of class <code>overpass_query</code>. The actual query passed to the <code>overpass API</code> with a query can be obtained with the function <code><a href="../reference/qry_to_string.html">qry_to_string()</a></code>. Applied to the preceding query, this function gives:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/qry_to_string.html">qry_to_string</a></span>(q)</code></pre></div>
<pre><code>## [out:xml][timeout:25];
## (
##   node
##     ["highway"="motorway"]
##     (51.2867602,-0.510375,51.6918741,0.3340155);
##   way  
##     ["highway"="motorway"]
##     (51.2867602,-0.510375,51.6918741,0.3340155);
##   relation  
##     ["highway"="motorway"]
##     (51.2867602,-0.510375,51.6918741,0.3340155);
## );
## (._;&gt;);out body;</code></pre>
<p>The resultant output may be pasted directly into the <a href="http://overpass-turbo.eu/">overpass-turbo</a> online interactive query builder. (The output of <code>qry_to_string</code> has been somewhat reformatted here to reflect the format typically used in <code>overpass-turbo</code>.)</p>
<div id="osmdata-queries" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#osmdata-queries" class="anchor"> </a></body></html>2.1. osmdata queries</h3>
<p>As demonstrated above, an <code>osmdata</code> query begins by specifying a bounding box with the function <code><a href="../reference/opq.html">opq()</a></code>, followed by specifying desired OSM features with <code><a href="../reference/add_feature.html">add_feature()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/opq.html">opq</a></span>(<span class="dt">bbox =</span> <span class="st">'Kunming, China'</span>)
q1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span>(q, <span class="dt">key =</span> <span class="st">'natural'</span>, <span class="dt">value =</span> <span class="st">'water'</span>)
q2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span>(q1, <span class="dt">key =</span> <span class="st">'name:en'</span>, <span class="dt">value =</span> <span class="st">'Dian'</span>, <span class="dt">exact =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>The parameter <code>exact=FALSE</code> controls the two ways of matching <code>key-value</code> pairs in <code>osmdata</code>: Either exactly and entirely, or through a partial string match. With the default <code>exact=TRUE</code>, this query would only return objects named ‘Dian’, and not, for example, any named ‘Lake Dian’. Using <code>exact=FALSE</code> will return ‘Lake Dian’ through just specifying <code>value='Dian'</code>.</p>
<p>Each successive feature added with <code><a href="../reference/add_feature.html">add_feature()</a></code> is added to previous features, so, for example, extending the previous query by an additional <code>key-value</code> pair to</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span>(q2, <span class="dt">key =</span> <span class="st">'highway'</span>)</code></pre></div>
<p>will request all objects that are both water bodies with names matching ‘Dian’ <strong>AND</strong> that are also highways. Unsurprisingly, this query returns no data, but the previous queries do: the filtering is more restrictive with each feature added with <code><a href="../reference/add_feature.html">add_feature()</a></code>.</p>
<p>The primary <code>osmdata</code> functions <code><a href="../reference/osmdata_sf.html">osmdata_sf()</a></code> or <code><a href="../reference/osmdata_sp.html">osmdata_sp()</a></code> pass these queries to <code>overpass</code> and return OSM data in corresponding <code>sf</code> or <code>sp</code> format, respectively. Both of these functions also accept direct <code>overpass</code> queries, such as those produced by the <code>osmdata</code> function <code><a href="../reference/qry_to_string.html">qry_to_string()</a></code>, or copied directly from the <a href="overpass-turbo.eu"><code>overpass-turbo</code> query builder</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (<span class="kw"><a href="../reference/qry_to_string.html">qry_to_string</a></span> (q))</code></pre></div>
<pre><code>## Object of class 'osmdata' with:
##                  $bbox :
##         $overpass_call : The call submitted to the overpass API
##             $timestamp : [ Tue Mar  7 10:06:30 2017 ]
##            $osm_points : 'sf' Simple Features Collection with 360582 points
##            ...</code></pre>
<p>Note that the result contains no value for <code>bbox</code>, because that information is lost when the full <code>osmdata_query</code>, <code>q</code>, is converted to a string. Nevertheless, the results of the two calls <code><a href="../reference/osmdata_sf.html">osmdata_sf (qry_to_string (q))</a></code> and <code><a href="../reference/osmdata_sf.html">osmdata_sf (q)</a></code> differ only in the values of <code>bbox</code> and <code>timestamp</code>, while returning otherwise identical data.</p>
<p>In summary, <code>osmdata</code> queries are generally simplified versions of potentially more complex <code>overpass</code> queries, although arbitrarily complex <code>overpass</code> queries may be passed directly to the primary <code>osmdata</code> functions. As illustrated above, <code>osmdata</code> queries are generally constructed through initiating a query with <code><a href="../reference/opq.html">opq()</a></code>, and then specifying OSM features in terms of <code>key-value</code> pairs with <code>add_feeature()</code>.</p>
<p>The simplest way to use <code>osmdata</code> is to simply request all data within a given bounding box:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/opq.html">opq</a></span>(<span class="dt">bbox =</span> <span class="st">'London City, U.K.'</span>)
lots_of_data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q)</code></pre></div>
<p>Queries are, however, usually refined through using <code><a href="../reference/add_feature.html">add_feature()</a></code>, which minimally requires a single <code>key</code> and returns all objects specifying any value for that <code>key</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span>(q, <span class="dt">key =</span> <span class="st">'highway'</span>)
q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span>(q, <span class="dt">key =</span> <span class="st">'name'</span>)
not_so_much_data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q)</code></pre></div>
<p><code>osmdata</code> will use that query to return all named highways within the requested bounding box. Note that <code>key</code> specifications are requests for features which must include those keys, yet most features will also include many other keys, and thus <code>osmdata</code> objects generally list a large number of distinct keys, as demonstrated below.</p>
</div>
<div id="query-example" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#query-example" class="anchor"> </a></body></html>2.2. Query example</h3>
<p>To appreciate query building in more concrete terms, let’s imagine that we wanted to find all cycle paths in Seville, Spain:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/opq.html">opq</a></span>(<span class="st">'Seville'</span>)
q1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span>(q0, <span class="dt">key =</span> <span class="st">'highway'</span>, <span class="dt">value =</span> <span class="st">'cycleway'</span>)
cway_sev &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_sp.html">osmdata_sp</a></span>(q1)
sp<span class="op">::</span><span class="kw">plot</span>(cway_sev<span class="op">$</span>osm_lines)</code></pre></div>
<p><img src="osmdata_files/figure-html/opq-seville-plot-1.png" width="672"></p>
<p>Now imagine we want to make a more specific query that only extracts designated cycleways or those which are bridges. Combining these into one query will return only those that are designated cycleways <strong>AND</strong> that are bridges:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span>(q1, <span class="dt">key =</span> <span class="st">'bicycle'</span>, <span class="dt">value =</span> <span class="st">'designated'</span>)
q2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span>(q2, <span class="dt">key =</span> <span class="st">'bridge'</span>, <span class="dt">value =</span> <span class="st">'yes'</span>)
cway_sev_bicycle_des_bridge &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span>(q2)
<span class="kw">nrow</span> (des_bike_and_bridge<span class="op">$</span>osm_points); <span class="kw">nrow</span> (des_bike_and_bridge<span class="op">$</span>osm_lines)</code></pre></div>
<pre><code>## [1] 7 3</code></pre>
<p>That query returns only 7 points and 3 lines. Designed cycleways <strong>OR</strong> bridges can be obtained through simply combining multiple <code>osmdata</code> objects with the <code>c</code> operator:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span>(q1, <span class="dt">key =</span> <span class="st">'bicycle'</span>, <span class="dt">value =</span> <span class="st">'designated'</span>)
q3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span>(q1, <span class="dt">key =</span> <span class="st">'bridge'</span>, <span class="dt">value =</span> <span class="st">'yes'</span>)
d2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span>(q2)
d3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span>(q3)
des_bike_or_bridge &lt;-<span class="st"> </span><span class="kw">c</span> (<span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span>(q2), <span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span>(q3))
<span class="kw">nrow</span> (des_bike_or_bridge<span class="op">$</span>osm_points); <span class="kw">nrow</span> (des_bike_or_bridge<span class="op">$</span>osm_lines)</code></pre></div>
<pre><code>## [1] 208  40</code></pre>
<p>And as expected, the <code>OR</code> operation produces more data than the equivalent <code>AND</code>.</p>
</div>
</div>
<div id="the-osmdata-object" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#the-osmdata-object" class="anchor"> </a></body></html>3. The <code>osmdata</code> object</h2>
<p>The <code>osmdata</code> extraction functions, <code><a href="../reference/osmdata_sf.html">osmdata_sf()</a></code>, and <code><a href="../reference/osmdata_sp.html">osmdata_sp()</a></code>, both return objects of class <code>osmdata</code>, the structure of which is shown with the generic print method as demonstrated above. The actual spatial data contained in an <code>osmdata</code> object are of either <code>sp</code> format when extracted with <code><a href="../reference/osmdata_sp.html">osmdata_sp()</a></code> or <code>sf</code> format when extracted with <code><a href="../reference/osmdata_sf.html">osmdata_sf()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span> (<span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q)<span class="op">$</span>osm_lines)</code></pre></div>
<pre><code>## [1] "sf"         "data.frame"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span> (<span class="kw"><a href="../reference/osmdata_sp.html">osmdata_sp</a></span> (q)<span class="op">$</span>osm_lines)</code></pre></div>
<pre><code>## [1] "SpatialLinesDataFrame"
## attr(,"package")
## [1] "sp"</code></pre>
<p>In addition to these two functions, <code>osmdata</code> provides a third function, <code><a href="../reference/osmdata_xml.html">osmdata_xml()</a></code>, which allows raw OSM data to be returned and optionally saved to disk in XML format. The following code demonstrates this function, beginning with a new query.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/opq.html">opq</a></span>(<span class="dt">bbox =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.12</span>, <span class="fl">51.51</span>, <span class="op">-</span><span class="fl">0.11</span>, <span class="fl">51.52</span>)) <span class="co"># Central London, U.K.</span>
q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span>(q, <span class="dt">key =</span> <span class="st">'building'</span>)
dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_xml.html">osmdata_xml</a></span>(q, <span class="dt">file=</span><span class="st">'buildings.osm'</span>)
<span class="kw">class</span> (dat)</code></pre></div>
<pre><code>## [1] "xml_document" "xml_node"</code></pre>
<p>This call both returns the same data as the object <code>dat</code> and saves them to the file <code>buildings.osm</code>. Downloaded XML data can be converted to <code>sf</code> or <code>sp</code> formats by simply passing the data to the respective <code>osmdata</code> functions, either as the name of a file or an XML object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">doc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_xml.html">osmdata_xml</a></span> (q, <span class="st">'buildings.osm'</span>)
dat1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q, doc)
dat2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q, <span class="st">'buildings.osm'</span>)
<span class="kw">identical</span> (dat1, dat2)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>The following sub-sections now explore these three functions in more detail, beginning with <code>osmdata_xnl()</code>.</p>
<div id="the-osmdata_xml-function" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#the-osmdata_xml-function" class="anchor"> </a></body></html>3.1. The <code><a href="../reference/osmdata_xml.html">osmdata_xml()</a></code> function</h3>
<p><code><a href="../reference/osmdata_xml.html">osmdata_xml()</a></code> returns OSM data in native XML format, and also allows these data to be saved directly to disk (conventionally using the file suffix <code>.osm</code>, although any suffix may be used). The <code>XML</code> data are formatting using the <code>R</code> package <code>xml2</code>, and may be processed within <code>R</code> using any methods compatible with such data, or may be processed by any other software able to load the <code>XML</code> data directly from disk.</p>
<p>The first few lines of the XML data downloaded above look like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">readLines</span> (<span class="st">'buildings.osm'</span>) [<span class="dv">1</span><span class="op">:</span><span class="dv">8</span>]</code></pre></div>
<pre><code>## [1] "&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;"                                                                             
## [2] "&lt;osm version=\"0.6\" generator=\"Overpass API\"&gt;"                                                                       
## [3] "  &lt;note&gt;The data included in this document is from www.openstreetmap.org. The data is made available under ODbL.&lt;/note&gt;"
## [4] "  &lt;meta osm_base=\"2017-03-07T09:28:03Z\"/&gt;"                                                                            
## [5] "  &lt;node id=\"21593231\" lat=\"51.5149566\" lon=\"-0.1134203\"/&gt;"                                                        
## [6] "  &lt;node id=\"25378129\" lat=\"51.5135870\" lon=\"-0.1115193\"/&gt;"                                                        
## [7] "  &lt;node id=\"25496793\" lat=\"51.5176768\" lon=\"-0.1111129\"/&gt;"                                                        
## [8] "  &lt;node id=\"25496827\" lat=\"51.5164528\" lon=\"-0.1093186\"/&gt;"</code></pre>
<p>These data can be used in any other programs able to read and process XML data, such as the open source GIS <a href="http://qgis.org/en/site/">QGIS</a> or the OSM data editor <a href="http://wiki.openstreetmap.org/wiki/JOSM">JOSM</a>. The remainder of this vignette assumes that not only do you want to get OSM data using R, you also want to import and eventually process it, using R. For that you’ll need to import the data into a native R class.</p>
<p>As demonstrated above, downloaded data can be directly processed by passing either filenames or the <code>R</code> objects containing those data to the <code>osmdata_sf/sp()</code> functions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat_sp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_sp.html">osmdata_sp</a></span> (q, <span class="st">'buildings.osm'</span>)
dat_sf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q, <span class="st">'buildings.osm'</span>)</code></pre></div>
</div>
<div id="the-osmdata_sf-function" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#the-osmdata_sf-function" class="anchor"> </a></body></html>3.2. The <code><a href="../reference/osmdata_sf.html">osmdata_sf()</a></code> function</h3>
<p><code><a href="../reference/osmdata_sf.html">osmdata_sf()</a></code> returns OSM data in <a href="http://www.opengeospatial.org/standards/sfo">Simple Features (SF)</a> format, defined by the <a href="http://www.opengeospatial.org">Open Geospatial Consortium</a>, and implemented in the <code>R</code> package <a href="https://cran.r-proejct.org/package=sf"><code>sf</code></a>. This package provides a direct interface to the <code>C++</code> <a href="http://gdal.org">Graphical Data Abstraction Library (GDAL)</a> which also includes a so-called <a href="http://www.gdal.org/drv_osm.html">‘driver’ for OSM data</a>. This means that OSM data may also be read directly with <code>sf</code>, rather than using <code>osmdata</code>. In this case, data must first be saved to disk, which can be readily achieved using <code><a href="../reference/osmdata_xml.html">osmdata_xml()</a></code> described above, or through downloading directly from the <a href="http://overpass-turbo.eu">overpass interactive query builder</a>.</p>
<p>The following example is based on this query:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/opq.html">opq</a></span> (<span class="dt">bbox =</span> <span class="st">'Trentham, Australia'</span>)
q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span> (q, <span class="dt">key =</span> <span class="st">'name'</span>) <span class="co"># any named objects</span>
<span class="kw"><a href="../reference/osmdata_xml.html">osmdata_xml</a></span> (q, <span class="st">'trentham.osm'</span>)</code></pre></div>
<p><code>sf</code> can then read such data independent of <code>osmdata</code> though</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sf<span class="op">::</span><span class="kw">st_read</span> (<span class="st">'trentham.osm'</span>, <span class="dt">layer =</span> <span class="st">'points'</span>)</code></pre></div>
<pre><code>## Reading layer `points' from data source `trentham.osm' using driver `OSM'
## Simple feature collection with 38 features and 10 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: 144.2894 ymin: -37.4846 xmax: 144.3893 ymax: -37.36012
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs</code></pre>
<p>The <code>GDAL</code> drivers used by <code>sf</code> can only load single ‘layers’ of features, for example, <code>points</code>, <code>lines</code>, or <code>polygons</code>. In contrast, <code>osmdata</code> loads all features simultaneously:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q, <span class="st">'trentham.osm'</span>)</code></pre></div>
<pre><code>## Object of class 'osmdata' with:
##                  $bbox : -37.4300874,144.2863388,-37.3500874,144.3663388
##         $overpass_call : The call submitted to the overpass API
##             $timestamp : ##------ Tues Mar 7 09:36:02 2017 ------##
##            $osm_points : 'sf' Simple Features Collection with 7166 points
##             $osm_lines : 'sf' Simple Features Collection with 263 linestrings
##          $osm_polygons : 'sf' Simple Features Collection with 37 polygons
##        $osm_multilines : 'sf' Simple Features Collection with 1 multilinestrings
##     $osm_multipolygons : 'sf' Simple Features Collection with 6 multipolygons</code></pre>
<p>Even for spatial objects of the same type (the same ‘layers’ in <code>sf</code> terminology), <code>osmdata</code> returns considerably more objects–7,166 points compared .with just 38. The raw sizes of data returned can be compared with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s1 &lt;-<span class="st"> </span><span class="kw">object.size</span> (<span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q, <span class="st">'trentham.osm'</span>)<span class="op">$</span>osm_points)
s2 &lt;-<span class="st"> </span><span class="kw">object.size</span> (sf<span class="op">::</span><span class="kw">st_read</span> (<span class="st">'trentham.osm'</span>, <span class="dt">layer=</span><span class="st">'points'</span>, <span class="dt">quiet=</span><span class="ot">TRUE</span>))
<span class="kw">as.numeric</span> (s1 <span class="op">/</span><span class="st"> </span>s2)</code></pre></div>
<pre><code>## [1] 511.4193</code></pre>
<p>And the <code>osmdata points</code> contain over 500 times as much data. The primary difference between <code>sf/GDAL</code> and <code>osmdata</code> is that the former returns only those objects unique to each category of spatial object. Thus OSM nodes (<code>points</code> in <code>sf/osmdata</code> representations) include, in <code>sf/GDAL</code> representation, only those points which are not part of any other objects (such as lines or polygons). In contrast, the <code>osm_points</code> object returned by <code>osmdata</code> includes all points regardless of whether or not these are represented in other spatial objects. Similarly, <code>line</code> objects in <code>sf/GDAL</code> exclude any lines that are part of other objects such as <code>multipolygon</code> or <code>multiline</code> objects.</p>
<p>This processing of data by <code>sf/GDAL</code> has two important implications:</p>
<ol style="list-style-type: decimal">
<li><p>An implicit hierarchy of spatial objects is enforced through including elements of objects only at their ‘highest’ level of representation, where <code>multipolygon</code> and <code>multiline</code> objects are assumed to be at ‘higher’ levels than <code>polyon</code> or <code>line</code> objects, and these in turn are at ‘higher’ levels than <code>point</code> objects. <code>osmdata</code> makes no such hierarchical assumptions.</p></li>
<li><p>All OSM are structured by giving each object a unique identifier so that the components of any given object (the nodes of a line, for example, or the lines of a multipolygon) can be described simply by giving these identifiers. This enables the components of any OSM object to be examined in detail. The <code>sf/GDAL</code> representation obviates this ability through removing these IDs and reducing everything to geometries alone (which is, after all, why it is called ‘<em>Simple</em> Features’). This means, for example, that the <code>key-value</code> pairs of the <code>line</code> or <code>polygon</code> components of <code>multipolygon</code> can never be extracted from an <code>sf/GDAL</code> representation. In contrast, <code>osmdata</code> retains all unique identifiers for all OSM objects, and so readily enables, for example, the properties of all <code>point</code> objects of a <code>line</code> to be extracted.</p></li>
</ol>
<p>Another reason why <code>osmdata</code> returns more data than <code>GDAL/sf</code> is that the latter extracts only a restricted list of OSM <code>keys</code>, whereas <code>osmdata</code> returns all <code>key</code> fields present in the requested data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span> (sf<span class="op">::</span><span class="kw">st_read</span> (<span class="st">'trentham.osm'</span>, <span class="dt">layer=</span><span class="st">'points'</span>, <span class="dt">quiet=</span><span class="ot">TRUE</span>)) <span class="co"># these are the keys</span></code></pre></div>
<pre><code>##  [1] "osm_id"     "name"       "barrier"    "highway"    "ref"       
##  [6] "address"    "is_in"      "place"      "man_made"   "other_tags"
## [11] "geometry"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span> (<span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q, <span class="st">'trentham.osm'</span>)<span class="op">$</span>osm_points)</code></pre></div>
<pre><code>##  [1] "osm_id"           "name"             "X_description_"  
##  [4] "X_waypoint_"      "addr.city"        "addr.housenumber"
##  [7] "addr.postcode"    "addr.street"      "amenity"         
## [10] "barrier"          "denomination"     "foot"            
## [13] "ford"             "highway"          "leisure"         
## [16] "note_1"           "phone"            "place"           
## [19] "railway"          "railway.historic" "ref"             
## [22] "religion"         "shop"             "source"          
## [25] "tourism"          "waterway"         "geometry"</code></pre>
<p><code>key</code> fields which are not specified in a given set of OSM data are not returned by <code>osmdata</code>, while <code>GDAL/sf</code> returns the same <code>key</code> fields regardless of whether any values are specified.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">addr &lt;-<span class="st"> </span>sf<span class="op">::</span><span class="kw">st_read</span> (<span class="st">'trentham.osm'</span>, <span class="dt">layer=</span><span class="st">'points'</span>, <span class="dt">quiet=</span><span class="ot">TRUE</span>)<span class="op">$</span>address
<span class="kw">all</span> (<span class="kw">is.na</span> (addr))</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>and <code>key=address</code> contains no data yet is still returned by <code>GDAL/sf</code>.</p>
<p>Finally, note that <code>osmdata</code> will generally extract OSM data considerably faster than equivalent <code>sf/GDAL</code> routines (as detailed <a href="git-wiki">here</a>).</p>
</div>
<div id="the-osmdata_sp-function" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#the-osmdata_sp-function" class="anchor"> </a></body></html>3.3. The <code><a href="../reference/osmdata_sp.html">osmdata_sp()</a></code> function</h3>
<p>As with <code><a href="../reference/osmdata_sf.html">osmdata_sf()</a></code> described above, OSM data may be converted to <code>sp</code> format without using <code>osmdata</code> via the <code>sf</code> functions demonstrated below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span>sf<span class="op">::</span><span class="kw">st_read</span> (<span class="st">'buildings.osm'</span>, <span class="dt">layer =</span> <span class="st">'multipolygons'</span>, <span class="dt">quiet=</span><span class="ot">TRUE</span>)
dat_sp &lt;-<span class="st"> </span><span class="kw">as</span> (dat, <span class="st">'Spatial'</span>)
<span class="kw">class</span> (dat_sp)</code></pre></div>
<pre><code>## [1] "SpatialPolygonsDataFrame"
## attr(,"package")
## [1] "sp"</code></pre>
<p>These data are extracted using the GDAL, and so suffer all of the same shortcomings mentioned above. Note differences in the amount of data returned:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span> (dat_sp)</code></pre></div>
<pre><code>## [1] 560  25</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span> (<span class="kw"><a href="../reference/osmdata_sp.html">osmdata_sp</a></span> (q, <span class="dt">doc =</span> <span class="st">'buildings.osm'</span>)<span class="op">$</span>osm_polygons)</code></pre></div>
<pre><code>## [1] 566 114</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span> (<span class="kw"><a href="../reference/osmdata_sp.html">osmdata_sp</a></span> (q, <span class="dt">doc =</span> <span class="st">'buildings.osm'</span>)<span class="op">$</span>osm_multipolygons)</code></pre></div>
<pre><code>## [1] 15 52</code></pre>
</div>
</div>
<div id="recursive-searching" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#recursive-searching" class="anchor"> </a></body></html>4. Recursive searching</h2>
<p>As described above, <code>osmdata</code> returns all data of each type and so allows the components of any given spatial object to be examined in their own right. This ability to extract, for example, all points of a line, or all polygons which include a given set of points, is referred to as <em>recursive searching</em>.</p>
<p>Recursive searching is not possible with <code>GDAL/sf</code>, because OSM identifiers are removed, and only the unique data of each type of object are retained. To understand both recursive searching and why it is useful, note that OSM data are structured in three hierarchical levels:</p>
<ol style="list-style-type: decimal">
<li><p><code>nodes</code> representing spatial points</p></li>
<li><p><code>ways</code> representing lines, both as <code>polygons</code> (with connected ends) and non-polygonal <code>lines</code></p></li>
<li><p><code>relations</code> representing more complex objects generally comprising collections of <code>ways</code> and/or <code>nodes</code>. Examples include <code>multipolygon relations</code> comprising an outer polygon (which may itself be made of several distinct <code>ways</code> which ultimately connect to form a single circle), and several inner polygons.</p></li>
</ol>
<p>Recursive searching allows for objects within any one of these hierarchical levels to be extracted based on components in any other level. Recursive searching is performed in <code>osmdata</code> with the following functions:</p>
<ol style="list-style-type: decimal">
<li><p><code><a href="../reference/osm_points.html">osm_points()</a></code>, which extracts all <code>point</code> or <code>node</code> objects</p></li>
<li><p><code><a href="../reference/osm_lines.html">osm_lines()</a></code>, which extracts all <code>way</code> objects that are <code>lines</code> (that are, that are not <code>polygons</code>)</p></li>
<li><p><code><a href="../reference/osm_polygons.html">osm_polygons()</a></code>, which extracts all <code>polygon</code> objects</p></li>
<li><p><code><a href="../reference/osm_multilines.html">osm_multilines()</a></code>, which extracts all <code>multiline</code> objects; and</p></li>
<li><p><code><a href="../reference/osm_multipolygons.html">osm_multipolygons()</a></code>, which extracts all <code>multipolygon</code> objects.</p></li>
</ol>
<p>Each of these functions accepts as an argument a vector of OSM identifiers. To demonstrate these functions, we first re-create the example above of named objects from Trentham, Australia:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/opq.html">opq</a></span> (<span class="dt">bbox =</span> <span class="st">'Trentham, Australia'</span>)
q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_feature.html">add_feature</a></span> (q, <span class="dt">key =</span> <span class="st">'name'</span>) <span class="co"># any named objects</span>
tr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> (q)</code></pre></div>
<div id="example" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#example" class="anchor"> </a></body></html>4.1. Example</h3>
<p>Then imagine we are interested in the <code>osm_line</code> object describing the ‘Coliban River’:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">i &lt;-<span class="st"> </span><span class="kw">which</span> (tr<span class="op">$</span>osm_lines<span class="op">$</span>name <span class="op">==</span><span class="st"> 'Coliban River'</span>)
coliban &lt;-<span class="st"> </span>tr<span class="op">$</span>osm_lines [i,]
coliban [<span class="kw">which</span> (<span class="op">!</span><span class="kw">is.na</span> (coliban))]</code></pre></div>
<pre><code>## Simple feature collection with 1 feature and 3 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: 144.3235 ymin: -37.37162 xmax: 144.3335 ymax: 37.36366
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
##            osm_id          name waterway                       geometry
## 87104907 87104907 Coliban River    river LINESTRING(144.323471069336...</code></pre>
<p>The locations of the points of this line can be extracted directly from the <code>sf</code> object with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">coliban<span class="op">$</span>geometry [[<span class="dv">1</span>]]</code></pre></div>
<pre><code>## LINESTRING(144.323471069336 -37.3716201782227, 144.323944091797 -37.3714790344238, 144.324356079102 -37.3709754943848, 144.324493408203 -37.3704833984375, 144.324600219727 -37.370174407959, 144.324981689453 -37.3697204589844, 144.325149536133 -37.369441986084, 144.325393676758 -37.3690567016602, 144.325714111328 -37.3686943054199, 144.326080322266 -37.3682441711426)</code></pre>
<p>The output contains nothing other than geometries (because, to reiterate, these are ‘<em>Simple</em> Features’), and no further information regarding those points can be extracted. The Coliban River has a waterfall in Trentham, and one of the <code>osm_points</code> objects describes this waterfall. The information necessary to locate this waterfall is removed from the <code>GDAL/sf</code> representation, but can be extracted with <code>osmdata</code> with the following lines, noting that the OSM ID of the line <code>coliban</code> is given by <code>rownames (coliban)</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pts &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osm_points.html">osm_points</a></span> (tr, <span class="kw">rownames</span> (coliban))
wf &lt;-<span class="st"> </span>pts [<span class="kw">which</span> (pts<span class="op">$</span>waterway <span class="op">==</span><span class="st"> 'waterfall'</span>),]
wf [<span class="kw">which</span> (<span class="op">!</span><span class="kw">is.na</span> (wf))]</code></pre></div>
<pre><code>## Simple feature collection with 1 feature and 4 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: 144.3246 ymin: -37.37017 xmax: 144.3246 ymax: -37.37017
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
##                osm_id           name    tourism  waterway
## 1013064837 1013064837 Trentham Falls attraction waterfall
##                                  geometry
## 1013064837 POINT(144.324600219727 -37....</code></pre>
<p>This point could be used as the basis for further recursive searches. For example, all <code>multipolygon</code> objects which include Trentham Falls could be extracted with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/osm_multipolygons.html">osm_multipolygons</a></span> (tr, <span class="kw">rownames</span> (wf))</code></pre></div>
<p>Although this returns no data in this case, it nevertheless demonstrates the usefulness and ease of recursive searching with <code>osmdata</code>.</p>
</div>
</div>
<div id="related-packages" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#related-packages" class="anchor"> </a></body></html>5. Related Packages</h2>
<p><span class="citation">Eugster and Schlesinger (2012)</span> describe <code>osmar</code>, an R package for handling OSM data that enables visualisation, search and even rudimentary routing operations. <code>osmar</code> is not user friendly or able to download OSM data flexibly, as reported in an <a href="http://eprints.whiterose.ac.uk/77643/">early tutorial</a> comparing R and QGIS for handling OSM data <span class="citation">(Lovelace 2014)</span>.</p>
<p><code>osmdata</code> builds on two previous R packages: <code>osmplotr</code>, a package <a href="https://cran.r-project.org/package=osmplotr">available from CRAN</a> for accessing and plotting OSM data <span class="citation">(Padgham 2016)</span> and <code>overpass</code>, a <a href="https://github.com/hrbrmstr/overpass">GitHub package</a> by Bob Rudis that provides an R interface to the <a href="http://overpass-api.de/">overpass</a> API.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<html><body><a href="#references" class="anchor"> </a></body></html>6. References</h2>
<div id="refs" class="references">
<div id="ref-eugster_osmar:_2012">
<p>Eugster, Manuel J a, and Thomas Schlesinger. 2012. “Osmar: OpenStreetMap and R.” <em>The R Journal</em> 5 (1): 53–64.</p>
</div>
<div id="ref-lovelace_harnessing_2014">
<p>Lovelace, Robin. 2014. “Harnessing Open Street Map Data with R and QGIS.” <em>EloGeo</em>.</p>
</div>
<div id="ref-OpenStreetMap">
<p>OpenStreetMap contributors. 2017. “Planet dump retrieved from http://planet.osm.org.” <a href="http://www.openstreetmap.org" class="uri">http://www.openstreetmap.org</a>.</p>
</div>
<div id="ref-osmplotr">
<p>Padgham, Mark. 2016. <em>Osmplotr: Customisable Images of Openstreetmap Data</em>. <a href="https://cran.r-project.org/package=osmplotr" class="uri">https://cran.r-project.org/package=osmplotr</a>.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">1. Introduction</a></li>
      <li><a href="#the-overpass-api">2. The overpass API</a></li>
      <li><a href="#the-osmdata-object">3. The <code>osmdata</code> object</a></li>
      <li><a href="#recursive-searching">4. Recursive searching</a></li>
      <li><a href="#related-packages">5. Related Packages</a></li>
      <li><a href="#references">6. References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Mark Padgham, Bob Rudis, Robin Lovelace, Maëlle Salmon.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
