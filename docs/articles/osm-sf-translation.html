<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Translation of OSM to Simple Features • osmdata</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">osmdata</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/osmdatar/osmdatar">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Translation of OSM to Simple Features</h1>
                        <h4 class="author">Mark Padgham</h4>
            
            <h4 class="date">2017-01-25</h4>
          </div>

    
    
<div class="contents">
<div id="contents" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#contents" class="anchor"> </a></body></html>Contents</h2>
<p><a href="#1%20OSM%20data">1. OpenStreetMap Data Structure</a></p>
<p><a href="#2%20SF%20data">2. Simple Features Data Structure</a></p>
<p><a href="#3%20osmdata%20OSM%20to%20SF">3. How <code>osmdata</code> translates OSM into Simple Features</a></p>
<p><a href="#3.1%20OSM%20nodes">3.1. OSM Nodes</a></p>
<p><a href="#3.2%20OSM%20ways">3.2. OSM Ways</a></p>
<p><a href="#3.3%20OSM%20relations">3.3 OSM Relations</a></p>
<p><a href="#3.3(a)%20Multipolygon%20relations">3.3(a) Multipolygon Relations</a></p>
<p><a href="#3.3(b)%20Multilinestring%20relations">3.3(b) Multilinestring Relations</a></p>
<p><a href="#4.%20GDAL%20OSM%20to%20SF">4. <code>GDAL</code> Translation of OSM into Simple Features</a></p>
<p><a href="#4.1.%20OSM%20nodes">4.1. OSM Nodes</a></p>
<p><a href="#4.2.%20OSM%20ways">4.2. OSM Ways</a></p>
<p><a href="#4.3.%20OSM%20relations">4.3 OSM Relations</a></p>
<p><a href="#4.3(a).%20Multipolygon%20relations">4.3(a) Multipolygon Relations</a></p>
<p><a href="#4.3(b).%20Multilinestring%20relations">4.3(b) Multilinestring Relations</a></p>
<p><a href="#5.%20Examples">5 Examples</a></p>
<p><a href="#5.1.%20Routing">5.1 Routing</a></p>
<p><a href="#5.1(a).%20Routing%20with%20sf/GDAL">5.1(a) Routing with <code>sf/GDAL</code></a></p>
<p><a href="#5.1(b).%20Routing%20with%20osmdata">5.1(b) Routing with <code>osmdata</code></a></p>
<hr>
</div>
<div id="openstreetmap-data-structure" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#openstreetmap-data-structure" class="anchor"> </a></body></html>
<a name="1%20OSM%20data"></a>1. OpenStreetMap Data Structure</h2>
<p>OpenStreetMap (OSM) data has a unique structure that is not directly reconcilable with other modes of representing spatial data, notably including the widely-adopted Simple Features scheme of the Open Geospatial Consortium (OGC). The three primary spatial objects of OSM are:</p>
<ol style="list-style-type: decimal">
<li><p><code>nodes</code>, which are directly translatable to spatial points</p></li>
<li><p><code>ways</code>, which may be closed, in which case they form polygons, or unclosed, in which case they are (non-polygonal) lines.</p></li>
<li>
<code>relations</code> which are higher-level objects used to specify relationships between collections of ways and nodes. While there are several recognised categories of <code>relations</code>, in spatial terms these may be reduced to a binary distinction between:</li>
</ol>
<ol style="list-style-type: lower-alpha">
<li>
<code>multipolygon</code> relations, which specify relationships between an exterior polygon (through designating <code>role='outer'</code>) and possible inner polygons (<code>role='inner'</code>). These may or may not be designated with <code>type=multipolygon</code>. Political boundaries, for example, often have <code>type=boundary</code> rather than explicit <code>type-multipolygon</code>. <code>osmdata</code> identifies multioplygons as those <code>relation</code>s having at least one member with <code>role=outer</code> or <code>role=inner</code>.</li>
<li>In the absence of <code>inner</code> and <code>outer</code> roles, an OSM relation is assumed to be non-polygonal, and to instead form a colletion of non-enclosing lines.</li>
</ol>
<hr>
</div>
<div id="simple-features-data-structure" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#simple-features-data-structure" class="anchor"> </a></body></html>
<a name="2%20SF%20data"></a>2. Simple Features Data Structure</h2>
<p>The representation of spatial objects as Simple Features is described elsewhere, with this document merely reviewing relevant aspects. The Simple Features system assumes that spatial features can be represented in one of seven distinct primary classes, which by convention are referred to in all capital letters. Relevant classes for OSM data are:</p>
<ol style="list-style-type: decimal">
<li>POINT</li>
<li>MULTIPOINT</li>
<li>LINESTRING</li>
<li>MULTILINESTRING</li>
<li>POLYGON</li>
<li>MULTIPOLYGON</li>
</ol>
<p>(The seventh primary class is <code>GEOMETRYCOLLECTION</code> contain several objects with different geometries.) A ‘Simple Feature’ consists of a sequence of spatial coordinates, which for OSM data are only ever <code>XY</code> coordinates represented by a string of <code>X</code> coordinates contained within a bracket, followed by a string of <code>Y</code> coordinates. In addition to coordinate data and associated coordinate reference systems, a Simple Feature may include any number of additional data which quantify or qualify the feature of interest. In the <code>sf</code> extension to <code>R</code>, a single Simple Feature is represnted by one row of a <code>data.frame</code>, which the geometry stored in a single column, and any number of other columns containing these additional data.</p>
<p>Simple Feature geometries are referred to in this vignette using all capital letters, while OSM geometries use lower case. Similarly, the Simple Features standard of the OGC is referred to as <code>SF</code>, while the <code>R</code> package of the same name is referred to as <code>R::sf</code>–upper case <code>R</code> followed by lower case <code>sf</code>. Much functionality of <code>R::sf</code> is determined by the underlying Geospatial Data Abstraction Library (<code>GDAL</code>; described below). Representations of data are often discussed here with reference to <code>sf/GDAL</code>, where it may always be assumed that the translation and representation of data are determined by <code>GDAL</code> and not directly by the creators of <code>R::sf</code>.</p>
<hr>
</div>
<div id="how-osmdata-translates-osm-into-simple-features" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#how-osmdata-translates-osm-into-simple-features" class="anchor"> </a></body></html>
<a name="3%20osmdata%20OSM%20to%20SF"></a>3. How <code>osmdata</code> translates OSM into Simple Features</h2>
<div id="osm-nodes" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#osm-nodes" class="anchor"> </a></body></html>
<a name="3.1%20OSM%20nodes"></a>3.1. OSM Nodes</h3>
<p>OSM nodes translate directly into <code>SF::POINT</code> objects, with all OSM <code>key-value</code> pairs stored in additional <code>data.frame</code> columns.</p>
</div>
<div id="osm-ways" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#osm-ways" class="anchor"> </a></body></html>
<a name="3.2%20OSM%20ways"></a>3.2. OSM Ways</h3>
<p>OSM ways may be either polygons or (non-polygonal) lines. <code>osmdata</code> translates these into <code>SF::LINESTRING</code> and <code>SF::POLYGON</code> objects, respectively. Although polygonal and non-polygonal ways may have systematically different <code>key</code> fields, they are conflated here to the single set of <code>key</code> values common to all <code>way</code> objects regardless of shape. This enables direct comparison and uniform operation on both <code>SF::LINESTRING</code> and <code>SF::POLYGON</code> objects.</p>
</div>
<div id="osm-relations" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#osm-relations" class="anchor"> </a></body></html>
<a name="3.3%20OSM%20relations"></a>3.3 OSM Relations</h3>
<p>OSM relations comprising members with <code>role=outer</code> or <code>role=inner</code> are translated into <code>SF::MULTIPOLYGON</code> objects; otherwise they form <code>SF::MULTILINESTRING</code> objects. As for OSM ways, potentially systematic differences between OSM <code>key</code> fields for <code>multipolygon</code> and other <code>relation</code> objects are ignored in favour of returning identical <code>key</code> fields in both cases, whether or not <code>value</code> fields for those <code>key</code>s exist.</p>
<div id="a-multipolygon-relations" class="section level4">
<h4 class="hasAnchor">
<html><body><a href="#a-multipolygon-relations" class="anchor"> </a></body></html>
<a name="3.3(a)%20Multipolygon%20relations"></a>3.3(a) Multipolygon Relations</h4>
<p>An OSM multipolygon is translated by <code>osmdata</code> into a single <code>SF::MULTIPOLYGON</code> object which has an additional column specifying <code>num_members</code>. The <code>SF</code> geometry thus consists of a list (an <code>R::List</code> object) of this number of polygons, the first of which is the <code>outer</code> polygon, with all subsequent members forming closed inner rings.</p>
<p>Each of these inner rings are represented as OSM <code>ways</code>, and contain associated data <strong>not</strong> able to be represented in the single multipolygon representation. Each inner polygon is therefore additionally stored in the <code>sf</code> <code>data.frame</code> along with all associated data. Thus the row containing a multipolygon of <code>num_polygon</code> polygons is followed by <code>num_polygon - 1</code> rows containing the data for each <code>inner</code> polygon.</p>
<p>Note that OSM <code>relation</code> objects generally have fewer (or different) <code>key-value</code> pairs than do OSM <code>way</code> objects. Data describing the detailed properties of the contituent ways of a given OSM relation are stored with those <code>ways</code> rather than with the <code>relation</code>. <code>osmdata</code> follows this general principle, and stored the geometry of all <code>ways</code> of a <code>relation</code> with the relation itself (that is, as part of the <code>MULTIPOLYGON</code> or <code>MULTILINESTRING</code> object), while those ways are also stored themselves as <code>LINESTRING</code> (or potentially <code>POLYGON</code>) objects, from where their additional <code>key-value</code> data may be accessed.</p>
</div>
<div id="b-multilinestring-relations" class="section level4">
<h4 class="hasAnchor">
<html><body><a href="#b-multilinestring-relations" class="anchor"> </a></body></html>
<a name="3.3(b)%20Multilinestring%20relations"></a>3.3(b) Multilinestring Relations</h4>
<p>OSM <code>relations</code> that are not <code>multipolygons</code> are translated into <code>SF::MULTILINESTRING</code> objects. Each member of any OSM relation is attributed a <code>role</code>, which may be empty. <code>osmdata</code> collates all ways within a relation according to their <code>role</code>s. Thus, unlike multipolygon relations which are always translated into a single <code>sf::MULTIPOLYGON</code> object, multilinestring relations are translated by <code>omsdata</code> into potentially several <code>sf::MULTILINESTRING</code> objects, one for each unique role.</p>
<p>This is particularly useful because <code>relations</code> are often used to designated extended <code>highways</code> (for example, designated bicycle routes or motorways), yet these often exist in <code>primary</code> and <code>alternative</code> forms, with these categories specified in roles. Separating these roles enables immediate access to any desired role.</p>
<p>These multilinestring objects also have a column specifying <code>num_members</code>, as for multipolygons, with the primary member followed by <code>num_members</code> rows, one for each member of the multilinestring.</p>
<hr>
</div>
</div>
</div>
<div id="gdal-translation-of-osm-into-simple-features" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#gdal-translation-of-osm-into-simple-features" class="anchor"> </a></body></html>
<a name="4.%20GDAL%20OSM%20to%20SF"></a>4. <code>GDAL</code> Translation of OSM into Simple Features</h2>
<p>The <code>R</code> package <a href="https://cran.r-project.org/package=sf"><code>sf</code></a> provide an <code>R</code> implementation of Spatial Features, and provides a wrapper around GDAL for reading geospatial data. <code>GDAL</code> provides a <code>driver</code> to read OSM data, and thus <code>sf</code> can also be used to read <code>OSM</code> data in <code>R</code>. However, the <code>GDAL</code> translation of OSM data differs in several important ways from the <code>osmdata</code> translation.</p>
<p>The primary difference is that GDAL only returns <em>unique</em> objects of each spatial (SF) type. Thus <code>sf::POINT</code> objects consist of only those points that are not otherwise members of some ‘higher’ object (<code>line</code>, <code>polygon</code>, or <code>relation</code> objects). Although a given set of OSM data may actually contain a great many points, attempting to load these with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sf::<span class="kw">st_read</span> (file, <span class="dt">layer=</span><span class="st">'points'</span>)</code></pre></div>
<p>will generally return surprisingly few points.</p>
<div id="osm-nodes-1" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#osm-nodes-1" class="anchor"> </a></body></html>
<a name="4.1.%20OSM%20nodes"></a>4.1. OSM Nodes</h3>
<p><code>osmdata</code> returns an <code>sf::POINTS</code> structure containing <strong>all</strong> nodes within a given set of OSM data—this will generally represent far more data than retuned by <code>sf::st_read (file, layer='points')</code>. In addition to this difference, the representation of points remains identical, with <code>osmdata</code> merely differing in retaining all <code>key-value</code> pairs, whereas <code>GDAL</code> only retains a select few of these.</p>
</div>
<div id="osm-ways-1" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#osm-ways-1" class="anchor"> </a></body></html>
<a name="4.2.%20OSM%20ways"></a>4.2. OSM Ways</h3>
<p>As for points, <code>sf</code> only returns those ways that are not represented or contained in ‘higher’ objects (OSM relations interpreted as <code>SF::MULTIPOLYGON</code> or <code>SF::MULTILINESTRING</code> objects). <code>osmdata</code> returns all ways, and thus enables, for example, examination of the full attributes of any member of a multigeometry object. This is not possible with the <code>GDAL/sf</code> translation.</p>
<p>As for points, the only additional difference between <code>osmdata</code> adn <code>GDAL/sf</code> is that <code>osmdata</code> retains all <code>key-value</code> pairs, whereas <code>GDAL</code> retains only a select few.</p>
</div>
<div id="osm-relations-1" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#osm-relations-1" class="anchor"> </a></body></html>
<a name="4.3.%20OSM%20relations"></a>4.3 OSM Relations</h3>
<p>Translation of OSM relations into Simple Features differs more significantly between <code>osmdata</code> and <code>GDAL/sf</code>.</p>
<div id="a-multipolygon-relations-1" class="section level4">
<h4 class="hasAnchor">
<html><body><a href="#a-multipolygon-relations-1" class="anchor"> </a></body></html>
<a name="4.3(a).%20Multipolygon%20relations"></a>4.3(a) Multipolygon Relations</h4>
<p>As indicated above, multipolygon relations are translated in broadly comparable ways by both <code>osmdata</code> and <code>sf/GDAL</code>. Note, however, the <code>way</code> members of an OSM relation may be specified in arbitrary order, and the multipolygonal way may not necessarily be traced through simply following the segments in the order returned by <code>sf/GDAL</code>.</p>
</div>
<div id="b-multilinestring-relations-1" class="section level4">
<h4 class="hasAnchor">
<html><body><a href="#b-multilinestring-relations-1" class="anchor"> </a></body></html>
<a name="4.3(b).%20Multilinestring%20relations"></a>4.3(b) Multilinestring Relations</h4>
<p>Linestring relations are simply read by GDAL directly in terms of the their constituent ways, resulting in a single <code>SF::MULTILINESTRING</code> object that contains exactly the same number of lines as the ways in the OSM relation, regardless of their <code>role</code>s. Note that <code>roles</code> are frequently used to specify <code>alternative</code> multi-way routes through a single OSM relation. Such distinctions between primary and alternative are erased with <code>GDAL/sf</code> reading.</p>
</div>
</div>
</div>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#examples" class="anchor"> </a></body></html>
<a name="5.%20Examples"></a>5 Examples</h2>
<div id="routing" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#routing" class="anchor"> </a></body></html>
<a name="5.1.%20Routing"></a>5.1 Routing</h3>
<p>Navigable paths, routes, and ways are all tagged within OSM as <code>highway</code>, readily enabling an <code>overpass</code> query to return only <code>ways</code> that can be used for routing purposes. Routes are nevertheless commonly assembled within OSM relations, particularly where they form major, designated transport ways such as long-distance foot or bicycle paths or major motorways.</p>
<div id="a-routing-with-sfgdal" class="section level4">
<h4 class="hasAnchor">
<html><body><a href="#a-routing-with-sfgdal" class="anchor"> </a></body></html>
<a name="5.1(a).%20Routing%20with%20sf/GDAL"></a>5.1(a) Routing with <code>sf/GDAL</code>
</h4>
<p>A query for <code>key=highway</code> translated through <code>GDAL/sf</code> will return those ways not part of any ‘higher’ structure as <code>SF::LINESTRING</code> objects, but components of an entire transport network might also be returned as:</p>
<ol style="list-style-type: decimal">
<li>
<code>SF::MULTIPOLYGON</code> objects, holding all single ways which form simple polygons (that is, in which start and end points are the same);</li>
<li>
<code>SF::MULTIPOLYGON</code> objects holding all single (non-polygonal) ways which combine to form an <code>OSM multipolygon</code> relation (that is, in which the collection of ways ultimately forms a closed <code>role=outer</code> polygon).</li>
<li>
<code>SF::MULTILINESTRING</code> objects holding all single (non-polygonal) ways which combine to form an OSM relation that is not a multipolygon.</li>
</ol>
<p>Translating these data into a single form usable for routing purposes is not simple. A particular problem that is <strong>extremely</strong> difficult to resolve is reconciling the <code>SF::MULTIPOLYGON</code> objects with the geometry of the <code>SF::LINESTRING</code> objects. Highway components contained in <code>SF::MULTIPOLYGON</code>s need to be re-connected with the network represented by the <code>SF::LINESTRING</code>s, yet the OSM identifiers of the <code>MULTIPOLYGON</code> components are removed by <code>sf/GDAL</code>, preventing these components from being directly re-connected. The only way to ensure connection would be to re-connect those geographic points sharing identical coordinates. This would require code too long and complicated to be worthwhile demonstrating here.</p>
</div>
<div id="b-routing-with-osmdata" class="section level4">
<h4 class="hasAnchor">
<html><body><a href="#b-routing-with-osmdata" class="anchor"> </a></body></html>
<a name="5.1(b).%20Routing%20with%20osmdata"></a>5.1(b) Routing with <code>osmdata</code>
</h4>
<p><code>osmdata</code> retains all of the underlyhing ways of ‘higher’ structures (<code>SF::MULTIPOLYGON</code> or <code>SF::MULTILINESTRING</code> objects) as <code>SF::LINESTRING</code> or <code>SF::POLYGON</code> objects. The geometries of the latter objects duplicate thosee of the ‘higher’ relations, yet contain additional <code>key-value</code> pairs corresponding to each way. Most importantly, the OSM ID value for each member of a <code>relation</code> are stored within that relation, readily enabling the individual ways (<code>LINESTRING</code> or <code>POLYGON</code> objects) to be identified from the <code>relation</code> (<code>MULTIPOLYGON</code> or <code>MULTILINESTRING</code> object).</p>
<p>The <code>osmdata</code> translation readily enables a singlularly complete network to be reconstructed by simply combining the <code>SF::LINESTRING</code> layer with the <code>SF::POLYGON</code> layer. These layers will always contain entirely independent members, and so will always be able to be directly combined without duplicating any objects.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#contents">Contents</a></li>
      <li>
<a href="#openstreetmap-data-structure"></a><a name="1%20OSM%20data"></a>1. OpenStreetMap Data Structure</li>
      <li>
<a href="#simple-features-data-structure"></a><a name="2%20SF%20data"></a>2. Simple Features Data Structure</li>
      <li>
<a href="#how-osmdata-translates-osm-into-simple-features"></a><a name="3%20osmdata%20OSM%20to%20SF"></a>3. How <code>osmdata</code> translates OSM into Simple Features</li>
      <li>
<a href="#gdal-translation-of-osm-into-simple-features"></a><a name="4.%20GDAL%20OSM%20to%20SF"></a>4. <code>GDAL</code> Translation of OSM into Simple Features</li>
      <li>
<a href="#examples"></a><a name="5.%20Examples"></a>5 Examples</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Mark Padgham, Bob Rudis, Robin Lovelace, Maëlle Salmon.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
